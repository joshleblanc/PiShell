# Kamal deployment configuration
# See https://kamal-deploy.org/docs/configuration/

service: picrust 

# Primary server (proxy disabled â€” this is a Discord bot, not a web app)
servers:
  web:
    hosts:
      - <%= ENV["DEPLOY_HOST"] %>
    proxy: false

# Docker registry authentication
registry:
  server: localhost:5555

env:
  secret:
    - MINIMAX_API_KEY
    - DISCORD_TOKEN
    - OWNER_ID
  clear:
    PI_CODING_AGENT_DIR: /home/picrust
    ASPNETCORE_ENVIRONMENT: Production

builder:
  context: PiCrust
  dockerfile: PiCrust/Dockerfile
  arch:
    - amd64  

aliases:
  shell: app exec --interactive --reuse "bash"
  logs: app logs -f
  agent-files: app exec --interactive --reuse "ls -la /home/picrust/"

# Build args passed to docker buildx build
# build_args:
#   - BUILD_CONFIG=Release

# Environment variables to set in the application container
# env:
#   clear:
#     RAILS_ENV: production
#   secret:
#     - RAILS_MASTER_KEY
#     - SOME_API_KEY

# Environment file(s) to load (on server)
# env_file:
#   - .env.production


# Persistent data volumes (Docker volumes)
volumes:
  - /home/picrust:/home/picrust
